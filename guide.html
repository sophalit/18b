<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Telegram Mini App Shop â€” Full Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    pre { white-space: pre-wrap; word-break: break-all; }
    code { font-size: 0.85rem; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans leading-relaxed">

  <!-- ======== HEADER ======== -->
  <header class="bg-blue-700 text-white py-10">
    <div class="max-w-4xl mx-auto px-4">
      <h1 class="text-3xl font-bold mb-4">ğŸ›’ Telegram Mini App Shop</h1>
      <p class="text-lg mb-4">From scratch â†’ Working MVP â†’ Deploy-ready</p>
      <ul class="list-disc list-inside space-y-1 text-blue-100">
        <li>Follow stages 0-9 in order</li>
        <li>Each stage has 4 cards: <strong>Concept</strong>, <strong>Code</strong>, <strong>Output</strong>, <strong>Practice</strong></li>
        <li>All code is TypeScript â€” API (Express), Bot (grammY), Web (React + Vite)</li>
        <li>Tailwind CSS via CDN â€” no build-time config needed</li>
        <li>Copy/paste every file from the project section below the guide</li>
      </ul>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-8 space-y-12">

    <!-- ==================== STAGE 0 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 0 â€” Prerequisites &amp; Tools</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <!-- Concept -->
        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>Before writing code, install the toolchain. We use a <strong>monorepo</strong> (npm workspaces) with three apps: <code>api</code>, <code>bot</code>, and <code>web</code>. MySQL runs in Docker so you don't install it on your machine.</p>
          <ul class="list-disc list-inside mt-2 text-sm space-y-1">
            <li><strong>Node.js â‰¥ 18</strong> (LTS)</li>
            <li><strong>npm â‰¥ 9</strong> (comes with Node)</li>
            <li><strong>Docker Desktop</strong> (for MySQL)</li>
            <li><strong>ngrok</strong> (free tier) â€” exposes localhost over HTTPS</li>
            <li>A <strong>Telegram account</strong> + BotFather bot</li>
            <li>A code editor (VS Code recommended)</li>
          </ul>
        </div>

        <!-- Code -->
        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># Check versions
node -v        # should be â‰¥ 18
npm -v         # should be â‰¥ 9
docker -v      # Docker Engine â‰¥ 20

# Install ngrok (macOS)
brew install ngrok
# or download from https://ngrok.com

# Sign up for ngrok free account
ngrok config add-authtoken YOUR_TOKEN</code></pre>
        </div>

        <!-- Output -->
        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><code>node -v</code> prints v18+ âœ“</li>
            <li><code>docker -v</code> prints 20+ âœ“</li>
            <li><code>ngrok version</code> prints 3+ âœ“</li>
          </ul>
        </div>

        <!-- Practice -->
        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Run <code>docker run --rm hello-world</code> â€” confirm Docker works.</li>
            <li>Run <code>ngrok http 3000</code> â€” see a Forwarding URL. Press Ctrl+C to stop.</li>
            <li>Create a test folder and run <code>npm init -y</code> â€” check <code>package.json</code> is generated.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 1 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 1 â€” Create Telegram Bot + BotFather</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>Every Telegram Mini App is attached to a bot. The bot provides the <strong>"Open Shop"</strong> button, and the token is used for <strong>initData validation</strong>.</p>
          <ul class="list-disc list-inside mt-2 text-sm space-y-1">
            <li>Open Telegram, talk to <strong>@BotFather</strong></li>
            <li>Send <code>/newbot</code>, choose a name and username</li>
            <li>Copy the <strong>bot token</strong> (keep it secret!)</li>
            <li>Send <code>/mybots</code> â†’ select bot â†’ <strong>Bot Settings</strong> â†’ <strong>Menu Button</strong> â†’ set URL later (after ngrok)</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># In BotFather chat:
/newbot
# â†’ Name: My Test Shop
# â†’ Username: my_test_shop_bot
# â†’ Token: 123456789:ABCdefGHI...

# Save token to .env files later:
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHI...</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>BotFather replies with your bot token âœ“</li>
            <li>Searching your bot username in Telegram shows your bot âœ“</li>
            <li>Sending <code>/start</code> to your bot gets no response (yet) âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Create a second test bot â€” practice the BotFather flow.</li>
            <li>Try <code>/setdescription</code> on your bot in BotFather.</li>
            <li>Note: You can always <code>/deletebot</code> test bots later.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 2 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 2 â€” Monorepo Setup</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>We use <strong>npm workspaces</strong> to manage three apps in one repo. The root <code>package.json</code> declares workspaces under <code>apps/*</code>. One <code>npm install</code> at root installs dependencies for all apps.</p>
          <p class="mt-2 text-sm">Folder layout:</p>
          <pre class="bg-gray-100 rounded p-2 text-xs mt-1"><code>tg-shop/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/    â† Express + Prisma
â”‚   â”œâ”€â”€ bot/    â† grammY bot
â”‚   â””â”€â”€ web/    â† React + Vite
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ package.json</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># Create root
mkdir tg-shop && cd tg-shop
npm init -y

# Edit package.json:
# "workspaces": ["apps/*"]

# Create app dirs
mkdir -p apps/api apps/bot apps/web

# Init each workspace
cd apps/api && npm init -y && cd ../..
cd apps/bot && npm init -y && cd ../..
cd apps/web && npm init -y && cd ../..

# Install all from root
npm install</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>Root <code>node_modules/</code> created âœ“</li>
            <li>Each <code>apps/*/package.json</code> exists âœ“</li>
            <li><code>npm ls --workspaces</code> shows 3 packages âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Run <code>npm ls -a --workspaces</code> and read the output.</li>
            <li>Add a dev dependency to just the api: <code>npm i -D typescript -w apps/api</code></li>
            <li>Understand that <code>-w</code> targets a specific workspace.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 3 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 3 â€” MySQL + Prisma Schema</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>MySQL runs in Docker (no local install needed). <strong>Prisma</strong> is our ORM â€” it auto-generates a type-safe client from a schema file.</p>
          <p class="mt-2 text-sm">Schema tables:</p>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><strong>User</strong> â€” telegramId (unique), firstName, username</li>
            <li><strong>Product</strong> â€” title, priceCents, imageUrl, active</li>
            <li><strong>Order</strong> â€” userId FK, totalCents, status</li>
            <li><strong>OrderItem</strong> â€” orderId FK, productId FK, qty, unitCents</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># docker-compose.yml at root
services:
  mysql:
    image: mysql:8.0
    ports: ["3306:3306"]
    environment:
      MYSQL_ROOT_PASSWORD: tgshop
      MYSQL_USER: tgshop
      MYSQL_PASSWORD: tgshop
      MYSQL_DATABASE: tgshop
    volumes:
      - mysqldata:/var/lib/mysql
volumes:
  mysqldata:

# Start MySQL
docker compose up -d

# In apps/api:
npx prisma init
# Edit prisma/schema.prisma â†’ add models
npx prisma migrate dev --name init
npx prisma db seed</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><code>docker ps</code> shows <code>mysql:8.0</code> running âœ“</li>
            <li>Prisma migration creates tables âœ“</li>
            <li>Seed inserts sample products âœ“</li>
            <li><code>npx prisma studio</code> opens a data browser âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Open Prisma Studio (<code>npx prisma studio</code>) and browse the Product table.</li>
            <li>Add a new product row manually in Studio.</li>
            <li>Reset the database: <code>npx prisma migrate reset</code> â€” observe it re-seeds.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 4 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 4 â€” API (Express + TypeScript)</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>The API is a standard Express server. Key points:</p>
          <ul class="list-disc list-inside text-sm space-y-1 mt-2">
            <li><strong>initData validation middleware</strong> â€” HMAC-SHA256 per Telegram spec</li>
            <li><strong>GET /health</strong> â€” health check</li>
            <li><strong>GET /products</strong> â€” public, returns active products</li>
            <li><strong>GET /me</strong> â€” authenticated, upserts user</li>
            <li><strong>POST /orders</strong> â€” authenticated, creates order + items</li>
          </ul>
          <p class="text-sm mt-2 text-red-600 font-semibold">âš  Never trust initDataUnsafe. Always validate on backend!</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code>// initData validation (core logic)
import crypto from "crypto";

function validateInitData(initData: string, botToken: string) {
  const params = new URLSearchParams(initData);
  const hash = params.get("hash");
  params.delete("hash");

  const pairs = [...params.entries()]
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([k, v]) => k + "=" + v)
    .join("\n");

  const secretKey = crypto
    .createHmac("sha256", "WebAppData")
    .update(botToken)
    .digest();

  const computed = crypto
    .createHmac("sha256", secretKey)
    .update(pairs)
    .digest("hex");

  if (computed !== hash) return null;

  const authDate = Number(params.get("auth_date"));
  if (Date.now() / 1000 - authDate > 86400) return null;

  return JSON.parse(params.get("user") ?? "{}");
}</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><code>curl http://localhost:3001/health</code> â†’ <code>{"ok":true}</code> âœ“</li>
            <li><code>curl http://localhost:3001/products</code> â†’ JSON array of products âœ“</li>
            <li>Requests to <code>/me</code> or <code>/orders</code> without initData â†’ 401 âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Hit <code>/products</code> with <code>curl</code> and pipe to <code>jq</code> for pretty output.</li>
            <li>Try sending a fake <code>x-telegram-init-data</code> header to <code>/me</code> â€” confirm 401.</li>
            <li>Add a new endpoint <code>GET /products/:id</code> that returns a single product.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 5 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 5 â€” Bot (grammY) + Open Shop Button</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>The bot uses <strong>grammY</strong> (lightweight Telegram bot framework). It does two things:</p>
          <ol class="list-decimal list-inside text-sm space-y-1 mt-2">
            <li>On <code>/start</code>, send a keyboard with a <strong>WebApp button</strong> that opens the Mini App</li>
            <li>Listen for <code>web_app_data</code> (sent by the Mini App via <code>sendData</code>) and confirm the order</li>
          </ol>
          <p class="text-sm mt-2">The WebApp URL must be <strong>HTTPS</strong> â€” use ngrok locally.</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code>import { Bot, Keyboard } from "grammy";

const bot = new Bot(process.env.TELEGRAM_BOT_TOKEN!);

bot.command("start", (ctx) => {
  const kb = new Keyboard()
    .webApp("ğŸ›’ Open Shop", process.env.WEBAPP_URL!)
    .resized();
  return ctx.reply("Welcome! Tap below to open the shop.", {
    reply_markup: kb,
  });
});

bot.on("message:web_app_data", (ctx) => {
  const data = JSON.parse(ctx.message.web_app_data.data);
  ctx.reply(
    `âœ… Order received! ${data.itemCount} items, total: $${(data.totalCents / 100).toFixed(2)}`
  );
});

bot.start();</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>Send <code>/start</code> â†’ Bot replies with "Open Shop" button âœ“</li>
            <li>Tapping "Open Shop" opens the Mini App in Telegram webview âœ“</li>
            <li>After checkout, bot confirms order in chat âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Change the bot's greeting message and restart.</li>
            <li>Add a second command <code>/help</code> that lists available actions.</li>
            <li>Try using an <strong>inline keyboard</strong> instead of a reply keyboard for the WebApp button.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 6 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 6 â€” Web UI (React + Vite + Tailwind CDN)</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>The Mini App is a <strong>React SPA</strong> built with Vite. Tailwind loads from CDN in <code>index.html</code>. The app:</p>
          <ol class="list-decimal list-inside text-sm space-y-1 mt-2">
            <li>Calls <code>Telegram.WebApp.ready()</code> and <code>expand()</code></li>
            <li>Fetches products from the API</li>
            <li>Shows a product grid with "Add to cart" buttons</li>
            <li>Shows a cart with total and "Checkout" button</li>
            <li>POSTs order to the API, then optionally calls <code>sendData</code></li>
          </ol>
          <p class="text-sm mt-2">If <code>Telegram.WebApp</code> is not available (opened outside Telegram), show a fallback message.</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code>&lt;!-- index.html (Tailwind via CDN) --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8" /&gt;
  &lt;meta name="viewport"
    content="width=device-width, initial-scale=1.0" /&gt;
  &lt;title&gt;TG Shop&lt;/title&gt;
  &lt;script
    src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
  &lt;script
    src="https://telegram.org/js/telegram-web-app.js"&gt;
  &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="root"&gt;&lt;/div&gt;
  &lt;script type="module"
    src="/src/main.tsx"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>Open <code>http://localhost:5173</code> â†’ see "Open in Telegram" fallback âœ“</li>
            <li>Open via Telegram bot â†’ products load, cart works âœ“</li>
            <li>Checkout creates order in database âœ“</li>
            <li>Bot receives order confirmation âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Change the product card layout â€” try a list view instead of grid.</li>
            <li>Add a "quantity" selector (+ / âˆ’) on each cart item.</li>
            <li>Style the checkout button with Telegram's theme colors using <code>Telegram.WebApp.themeParams</code>.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 7 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 7 â€” Local Test Checklist</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>Testing a Telegram Mini App locally requires HTTPS. We use <strong>ngrok</strong> to tunnel localhost:5173 (web) and localhost:3001 (api) to public HTTPS URLs. Then we set <code>WEBAPP_URL</code> on the bot to the ngrok web URL.</p>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># Terminal 1 â€” MySQL
docker compose up -d

# Terminal 2 â€” API
cd apps/api && npm run dev

# Terminal 3 â€” Web
cd apps/web && npm run dev

# Terminal 4 â€” ngrok for web
ngrok http 5173
# Copy the https://xxxx.ngrok.io URL

# Terminal 5 â€” ngrok for API (optional if web proxies)
ngrok http 3001

# Update .env files with ngrok URLs
# WEBAPP_URL=https://xxxx.ngrok-free.app
# VITE_API_URL=https://yyyy.ngrok-free.app

# Terminal 6 â€” Bot
cd apps/bot && npm run dev</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>MySQL container running âœ“</li>
            <li>API responds on localhost:3001 âœ“</li>
            <li>Web loads on localhost:5173 âœ“</li>
            <li>ngrok URLs are HTTPS âœ“</li>
            <li>Bot sends "Open Shop" button âœ“</li>
            <li>Full flow: open â†’ browse â†’ add â†’ checkout â†’ order saved âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Complete the full flow end-to-end: open â†’ add 2 items â†’ checkout â†’ verify order in Prisma Studio.</li>
            <li>Kill the API â€” observe how the web app handles the error.</li>
            <li>Open the web URL directly in a browser (not Telegram) â€” see the fallback message.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 8 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 8 â€” Deploy Checklist</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept</h3>
          <p>Deploy each part to a cloud provider:</p>
          <ul class="list-disc list-inside text-sm space-y-1 mt-2">
            <li><strong>Web</strong> â†’ Vercel / Netlify / Cloudflare Pages (free static hosting with HTTPS)</li>
            <li><strong>API</strong> â†’ Render / Railway / Fly.io (Node.js hosting with env vars)</li>
            <li><strong>Bot</strong> â†’ Same as API or a VPS (polling = no HTTPS needed)</li>
            <li><strong>MySQL</strong> â†’ PlanetScale / Railway / AWS RDS (managed MySQL, free tiers available)</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code># Deploy Web to Vercel
cd apps/web
npx vercel

# Deploy API to Render
# 1. Push to GitHub
# 2. Render â†’ New Web Service â†’ connect repo
# 3. Root directory: apps/api
# 4. Build: npm run build
# 5. Start: npm start
# 6. Set env vars:
#   DATABASE_URL=mysql://...
#   TELEGRAM_BOT_TOKEN=...
#   CORS_ORIGIN=https://your-web.vercel.app

# Deploy Bot to Render
# Same as API, root: apps/bot
# Set env vars:
#   TELEGRAM_BOT_TOKEN=...
#   WEBAPP_URL=https://your-web.vercel.app</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Output</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li>Web loads on <code>https://your-web.vercel.app</code> âœ“</li>
            <li>API health: <code>https://your-api.onrender.com/health</code> â†’ <code>{"ok":true}</code> âœ“</li>
            <li>Bot responds to <code>/start</code> with "Open Shop" âœ“</li>
            <li>Full flow works over production URLs âœ“</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Deploy to at least one provider and test the full flow.</li>
            <li>Set up a free PlanetScale or Railway MySQL and connect the API to it.</li>
            <li>Switch the bot from polling to webhook mode for production.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ==================== STAGE 9 ==================== -->
    <section>
      <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">Stage 9 â€” Hardening &amp; Extensions</h2>
      <div class="grid md:grid-cols-2 gap-4">

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-blue-500">
          <h3 class="font-bold text-blue-600 mb-2">ğŸ’¡ Concept â€” Hardening</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><strong>CORS</strong> â€” restrict to your web domain only</li>
            <li><strong>Rate limiting</strong> â€” use <code>express-rate-limit</code> to prevent abuse</li>
            <li><strong>Validation</strong> â€” use <code>Zod</code> to validate request bodies</li>
            <li><strong>Logging</strong> â€” structured logs (console or pino)</li>
            <li><strong>Env separation</strong> â€” <code>.env.development</code> vs <code>.env.production</code></li>
            <li><strong>Error handling</strong> â€” centralized error middleware that never leaks internals</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-green-500">
          <h3 class="font-bold text-green-600 mb-2">ğŸ–¥ï¸ Code â€” Hardening Examples</h3>
          <pre class="bg-gray-900 text-green-300 rounded p-3 text-xs overflow-x-auto"><code>// Rate Limiting
import rateLimit from "express-rate-limit";
app.use(rateLimit({ windowMs: 60_000, max: 60 }));

// Zod validation (POST /orders)
import { z } from "zod";
const OrderSchema = z.object({
  items: z.array(z.object({
    productId: z.number().int().positive(),
    qty: z.number().int().min(1).max(99),
  })).min(1),
});

// Centralized error handler
app.use((err, req, res, next) => {
  console.error(err);
  res.status(500).json({ error: "Internal error" });
});</code></pre>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-yellow-500">
          <h3 class="font-bold text-yellow-600 mb-2">âœ… Extensions (Next Steps)</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><strong>Admin CRUD</strong> â€” protect with a secret or admin telegramId list, build product management UI</li>
            <li><strong>Payments</strong> â€” integrate Telegram Payments API or Stripe. Outline: create invoice â†’ user pays â†’ webhook confirms â†’ update order status</li>
            <li><strong>Order status</strong> â€” add status updates (processing â†’ shipped â†’ delivered) and bot notifications</li>
            <li><strong>Product images</strong> â€” upload to S3/Cloudflare R2, store URL in DB</li>
            <li><strong>Search &amp; categories</strong> â€” add category model, filter UI</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow p-5 border-l-4 border-purple-500">
          <h3 class="font-bold text-purple-600 mb-2">ğŸ§ª Practice</h3>
          <ol class="list-decimal list-inside text-sm space-y-1">
            <li>Add rate limiting to the API and test with rapid requests.</li>
            <li>Add Zod validation to <code>POST /orders</code> â€” send bad data and observe 400 errors.</li>
            <li>Create an admin-only endpoint that checks <code>telegramId</code> against an allow-list.</li>
            <li>Outline a payment flow on paper before coding it.</li>
          </ol>
        </div>
      </div>
    </section>

  </main>

  <!-- ======== FOOTER ======== -->
  <footer class="bg-gray-800 text-gray-400 text-center py-6 mt-12">
    <p class="text-sm">Telegram Mini App Shop Guide Â· Built with TypeScript + Express + React + Prisma (MySQL) + grammY</p>
  </footer>

</body>
</html>
